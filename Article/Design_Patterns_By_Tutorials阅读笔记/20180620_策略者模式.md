title: ç­–ç•¥è€…æ¨¡å¼
date: 2018å¹´ 6æœˆ20æ—¥ æ˜ŸæœŸä¸‰ 06æ—¶13åˆ†11ç§’ CST
tags: Design Patterns

---


### Strategy Pattern (ç­–ç•¥è€…æ¨¡å¼)
####ä»€ä¹ˆæ˜¯ç­–ç•¥è€…æ¨¡å¼ï¼Ÿ

ç­–ç•¥æ¨¡å¼å®šä¹‰äº†å¯ä»¥åœ¨è¿è¡Œæ—¶è®¾ç½®æˆ–åˆ‡æ¢çš„å¯äº’æ¢å¯¹è±¡çš„ç®—æ³•æ—æˆ–è¡Œä¸ºæ—ï¼Œå…·ä½“æ¥è¯´æœ‰ä»¥ä¸‹å››ç‚¹:

1. åœ¨ iOS åº”ç”¨å¼€å‘ä¸­é€šå¸¸ä¼šä»¥ViewControlleråšä¸ºç­–ç•¥å¯¹è±¡ä½¿ç”¨è¯¥æ¨¡å¼æ—¶, ä½†åœ¨æŠ€æœ¯ä¸Šå®ƒå¯ä»¥æ˜¯ä»»ä½•éœ€è¦å¯äº’æ¢è¡Œä¸ºçš„å¯¹è±¡ï¼Œè€Œä¸é™äºŽæŸä¸€ç±»ã€‚
2. ç­–ç•¥è€…æ¨¡å¼é€šå¸¸ä¼šå®šä¹‰ä¸€ä¸ªProtocolï¼Œå£°æ˜Žå¿…é¡»å®žçŽ°çš„ç­–ç•¥æ–¹æ³•
3. æ‰€æœ‰çš„ç­–ç•¥éƒ½å¿…é¡»éµå¾ªå¹¶å®žçŽ°å®šä¹‰å¥½çš„ç­–ç•¥Protocol
4. ç­–ç•¥è€…çš„ç²¾é«“ - è¿è¡Œæ—¶æ›¿æ¢


#### UMLå›¾
![Strategy Pattern](http://7xli4x.com1.z0.glb.clouddn.com/Strategy Pattern.png)

#### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç­–ç•¥è€…æ¨¡å¼ï¼Ÿ

é€šå¸¸æœ‰ä½ æœ‰ä¸¤ç§æˆ–è€…ä¸¤ç§å¯äº’æ¢çš„è¡Œä¸ºæ—¶ï¼Œç®€å•è®²å°±æ˜¯åŒä¸€ä¸ªæ“ä½œéœ€è¦æœ‰å¤šç§ä¸åŒçš„å®žçŽ°æ–¹å¼å…±å­˜æ—¶ï¼Œè¿™æ—¶ä½ å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ç­–ç•¥è€…æ¨¡å¼äº†ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œå½“ä½ å‡ºè¡ŒåŽ»ä¸€ä¸ªåœ°ç‚¹æ—¶ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸åŒçš„äº¤é€šå·¥å…·ï¼Œä½ å¯ä»¥åé£žæœºï¼Œåç«è½¦æˆ–è€…åå¤§å·´ï¼Œè€Œè¿™ä¸‰ç§æ–¹å¼ï¼Œå°±å¯ä»¥è€ƒè™‘ä¸ºä¸‰ç§å‡ºè¡Œç­–ç•¥ã€‚

å†ä¸¾ä¾‹iOSä¸­ï¼Œæ¯”å¦‚ä½ è¦å°†ä¸€ä¸ªå¯¹è±¡ç¼“å­˜èµ·æ¥ï¼Œä½ å¯ä»¥è€ƒè™‘ç”¨å½’æ¡£ï¼Œå¯ä»¥è€ƒè™‘ç”¨æ•°æ®åº“ï¼Œå¯ä»¥è€ƒè™‘å­˜æ–‡ä»¶ï¼Œä»–ä»¬æœ‰å…±åŒçš„åŠ¨ä½œå°±æ˜¯å°†å†…å®¹å­˜å‚¨èµ·æ¥ï¼Œè€Œä½ å¯ä»¥é€šè¿‡ä¸‰ç§ä¸åŒçš„å®žçŽ°æ–¹å¼ã€‚

*Strategy Pattern*ä¸Ž*Delegation pattern*å®ƒä»¬éƒ½æ˜¯ä¾èµ–Protocolè€Œä¸æ˜¯å…·ä½“å¯¹è±¡æ¥æé«˜çµæ´»æ€§ã€‚å› æ­¤ï¼Œä»»ä½•å®žçŽ°ç­–ç•¥åè®®çš„å¯¹è±¡éƒ½å¯ä»¥åœ¨åŠ¨ä½œæ—¶è¢«å½“ä½œä¸€ä¸ªç­–ç•¥æ¥å®žç”¨ã€‚

å’Œ*Delegation pattern*ä¸åŒçš„æ˜¯ï¼Œ*Strategy Pattern*é€šå¸¸æ˜¯ä»¥ä¸€ä¸ªç±»ç¾¤çš„æ–¹å¼å±•ç¤ºã€‚*Delegation pattern*ï¼Œä¸¾ä¾‹æ¥è¯´ï¼ŒUITableViewçš„dataSourceå’Œdelegateå¯ä»¥ä»ŽInterface Builderä¸­è®¾ç½®ï¼Œä¸€ç»è®¾å®šï¼Œåœ¨è¿è¡Œæ—¶å°†å¾ˆå°‘å†åŽ»æ”¹å˜å®ƒã€‚ç„¶è€Œ*Strategy Pattern*çš„è®¾è®¡æ—¨åœ¨è¿è¡Œæ—¶å®¹æ˜“äº’æ¢ã€‚

#### ä½¿ç”¨æ ·ä¾‹

``` swift
public protocol MovieRatingStrategy {
  // 1
  var ratingServiceName: String { get }
  
  // 2
  func fetchRating(for movieTitle: String,
    success: (_ rating: String, _ review: String) -> ())
}

public class RottenTomatoesClient: MovieRatingStrategy {
  public let ratingServiceName = "Rotten Tomatoes"
  
  public func fetchRating(
    for movieTitle: String,
    success: (_ rating: String, _ review: String) -> ()) {
    
    // In a real service, you'd make a network request...
    // Here, we just provide dummy values...
    let rating = "95%"
    let review = "It rocked!"
    success(rating, review)
  }
}


public class MoviewRatingViewController: UIViewController {
  
  // MARK: - Properties
  public var movieRatingClient: MovieRatingStrategy!
  
  // MARK: - Outlets
  @IBOutlet public var movieTitleTextField: UITextField!
  @IBOutlet public var ratingServiceNameLabel: UILabel!
  @IBOutlet public var ratingLabel: UILabel!
  @IBOutlet public var reviewLabel: UILabel!
  
  // MARK: - View Lifecycle
  public override func viewDidLoad() {
    super.viewDidLoad()
    ratingServiceNameLabel.text = 
      movieRatingClient.ratingServiceName
  }
  
  // MARK: - Actions
  @IBAction public func searchButtonPressed(sender: Any) {
    guard let movieTitle = movieTitleTextField.text
      else { return }
    
    movieRatingClient.fetchRating(for: movieTitle) {
      (rating, review) in
      self.ratingLabel.text = rating
      self.reviewLabel.text = review
    }
  }
}

```


